<div class="main">
    <div class="flex-container">
        <div class="cadre" [style.min-height]="cardContentHeight + 'px'">
            <pnx-map height="100%" class="map-card">
              <pnx-geojson
                  *ngIf="mapFeatures && mapFeatures['features']"
                  [geojson]="mapFeatures"
                  [zoomOnLayer]="true"
                  [zoomOnFirstTime]="true"
              ></pnx-geojson>
            </pnx-map>
        </div>
        <div class="cadre scroll">
            <gn-cmr-breadcrumb [path]="path" [currentPage]="(bEdit ? 'Edition ' : 'Création ') + module.forms.visit.label"></gn-cmr-breadcrumb>
            <h3>Module: {{ module.module_label }}</h3>
            <div class="clearfix">
              <h4 class="float-left">{{ (bEdit ? 'Edition ' : 'Création ') + module.forms.visit.label}}</h4>
              <span class="float-right" *ngIf="!bEdit">
                <i class="fa fa-repeat fa-lg"></i>
                <mat-slide-toggle id="repeat" color="primary" [(ngModel)]="bChainInput" matTooltip="Enchainer les saisies"></mat-slide-toggle>
              </span>
            </div>
            <form [formGroup]="visitForm">
                <div class="dynamic-form-wrapper">
                    <small>{{ module.forms.site.label}}</small>
                    <div class="input-group"><span>{{ site.name}}</span></div>
                </div>
                <div class="dynamic-form-wrapper mt-2 mb-2">
                  <div class="custom-control custom-checkbox">
                    <input type="checkbox" id="input_observ" class="custom-control-input" [formControl]="visitForm.get('observation')">
                    <label class="custom-control-label" for="input_observ"><span>Observation(s) pendant la visite?</span></label>
                </div>
              </div>
              <pnx-dynamic-form-generator
                class="obj-form"
                #dynamicForm
                [autoGenerated]="true"
                [myFormGroup]="genericVisitForm"
                [formsDefinition]="visitFormDefinitions"
              ></pnx-dynamic-form-generator>

              <div class="clearfix mt-3">
                <button class="btn btn-primary float-left" [routerLink]="['..']" *ngIf="!bEdit">Annuler</button>
                <button class="btn btn-primary float-left" [routerLink]="[visit.id_visit]" *ngIf="bEdit">Annuler</button>
                <button *ngIf="!bChainInput  && !bEdit" class="btn btn-success float-right ml-2" [disabled]="!visitForm.valid || !genericVisitForm.valid || !visitForm.get('observation').value || bSaving" (click)="onSubmit(true)">
                  <i class="fa fa-check" *ngIf="!bSaving"></i>
                  <i class="fa fa-spinner fa-spin" *ngIf="bSaving"></i>&nbsp;Valider et ajouter {{module.forms.observation.label}}</button>
                <button *ngIf="!bChainInput" class="btn btn-success float-right" [disabled]="!visitForm.valid || !genericVisitForm.valid || bSaving" (click)="onSubmit()">
                  <i class="fa fa-check" *ngIf="!bSaving"></i>
                  <i class="fa fa-spinner fa-spin" *ngIf="bSaving"></i>&nbsp;Valider</button>
                <button *ngIf="bChainInput && !bEdit" class="btn btn-success float-right" [disabled]="!visitForm.valid || !genericVisitForm.valid || bSaving" (click)="onSubmit()">
                  <i class="fa fa-check" *ngIf="!bSaving"></i>
                  <i class="fa fa-spinner fa-spin" *ngIf="bSaving"></i>&nbsp;Valider et enchainer les saisies</button>
              </div>
            </form>
        </div> 
    </div>
</div>
