<div class="main">
    <div class="flex-container">
        <div class="cadre" [style.min-height]="cardContentHeight + 'px'">
            <div id="details">
                <gn-cmr-breadcrumb [path]="path" [currentPage]="module.forms.site.label + ': ' + site.name"></gn-cmr-breadcrumb>
                <div class="toolbar clearfix">
                    <h3 class="float-left">{{module.forms.site.label}}: {{ site.name }}</h3>
                    <button class="btn btn-primary float-right" [routerLink]="['..', {edit: site.id_site}]"><i class="fa fa-pencil"></i>&nbsp;Editer</button>
                </div>
                <div class="">
                    <nav>
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                            <a class="nav-item nav-link active" data-toggle="tab" aria-selected="true" id="nav-site-tab" href="#site-tab">{{module.forms.site.label}}</a>
                            <a class="nav-item nav-link" data-toggle="tab" aria-selected="false" id="nav-media-tab" href="#media-tab">Medias<span class="badge badge-pill badge-primary ml-2">{{medias.length}}</span></a>
                        </div>
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade active show"
                                id="site-tab"
                                role="tabpanel"
                                attr.aria-labelledby="nav-site-tab">
                                <table class="table table-striped table-sm scrollable">
                                    <tr *ngFor="let fieldName of properties">
                                        <th>{{ fields[fieldName].attribut_label }}</th>
                                        <td class="text-in-area">{{ _dataService.formatProperty(site[fieldName], fields[fieldName])}}</td>
                                    </tr>
                                </table>
                                <pnx-map height="40vh" class="map-card">
                                    <pnx-geojson
                                        *ngIf="mapFeatures && mapFeatures['features']"
                                        [geojson]="mapFeatures"
                                        [zoomOnLayer]="true"
                                        [zoomOnFirstTime]="true"
                                    ></pnx-geojson>
                                </pnx-map>
                            </div>
                            <div class="tab-pane fade"
                                id="media-tab"
                                role="tabpanel"
                                attr.aria-labelledby="nav-media-tab">
                                <gn-cmr-media-list [medias]="medias"></gn-cmr-media-list>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
        <div class="cadre scroll">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link active" data-toggle="tab" aria-selected="true" id="nav-visit-tab" href="#visit-tab">{{module.forms.visit.label_plural}}<span class="badge badge-pill badge-primary ml-2">{{visits.length}}</span></a>
                    <a class="nav-item nav-link" data-toggle="tab" aria-selected="false" id="nav-individuals-tab" href="#individuals-tab">Individus<span class="badge badge-pill badge-primary ml-2">{{individuals.length}}</span></a>
                </div>
                <div class="tab-content" id="nav-tabContentRight">
                    <div class="tab-pane fade active show" id="visit-tab" role="tabpanel" attr.aria-labelledby="nav-visit-tab">
                        <div class="toolbar clearfix"><!-- TODO add cruved-->
                            <button class="btn btn-success float-left" [routerLink]="['visit']"><i class="fa fa-plus-circle"></i>&nbsp;Ajouter {{module.forms.visit.label}}</button>
                            <button disabled class="btn btn-primary float-right"><i class="fa fa-sliders"></i>&nbsp;Filtrer</button>
                        </div>
                        <ngx-datatable #table
                            class="material striped margin-top-xs"
                            [rows]="visits"
                            [rowHeight]="40"
                            [draggable]="false"
                            [count]="visits.length"
                            [limit]="15"
                            [headerHeight]="50"
                            [footerHeight]="50"
                            [sorts]="[{prop: 'date', dir:'desc'}]">

                            <ngx-datatable-column width="60">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <a class="clickable btn btn-no-padding bt-ghost" [routerLink]="['visit', row.id_visit]">
                                        <i class="fa fa-info-circle" aria-hidden="true" [matTooltip]="'Informations ' + module.forms.visit.label"></i>
                                    </a>
                                    <a class="clickable btn btn-no-padding bt-ghost ml-1" [routerLink]="['visit', {edit: row.id_visit}]">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true" [matTooltip]="'Editer ' + module.forms.visit.label"></i>
                                    </a>
                                </ng-template>
                            </ngx-datatable-column>
                            <ngx-datatable-column width="200" *ngFor="let prop of visitListProperties" [name]="visitFieldsDef[prop].attribut_label" [prop]="prop" >
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <span>{{_dataService.formatProperty(row[prop], visitFieldsDef[prop])}}</span>
                                </ng-template>
                            </ngx-datatable-column>
                        </ngx-datatable>
                    </div>
                    <div class="tab-pane fade" id="individuals-tab" role="tabpanel" attr.aria-labelledby="nav-individuals-tab">
                        <div class="toolbar clearfix">
                            <button disabled class="btn btn-primary float-right"><i class="fa fa-sliders"></i>&nbsp;Filtrer</button>
                        </div>
                        <ngx-datatable #table
                            class="material striped margin-top-xs"
                            [rows]="individuals"
                            [rowHeight]="40"
                            [draggable]="false"
                            [count]="individuals.length"
                            [limit]="15"
                            [headerHeight]="50"
                            [footerHeight]="50">

                            <ngx-datatable-column width="60">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                    <a class="clickable btn btn-no-padding bt-ghost" [routerLink]="[(site.id_sitegroup? '../../../..' : '../..'),'individual', row.id_individual]">
                                        <i class="fa fa-info-circle" aria-hidden="true" [matTooltip]="'Informations ' + module.forms.individual.label + ' ' + row.identifier"></i>
                                    </a>
                                    <a class="clickable btn btn-no-padding bt-ghost ml-1" [routerLink]="[(site.id_sitegroup? '../../../..' : '../..'), 'individual', {edit: row.id_individual}]">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true" matTooltip="'Editer ' + module.forms.individual.label + ' ' + row.identifier"></i>
                                    </a>
                                </ng-template>
                            </ngx-datatable-column>
                            <ngx-datatable-column width="150" *ngFor="let prop of individualListProperties" [name]="individualFieldsDef[prop].attribut_label" [prop]="prop" >
                            </ngx-datatable-column>
                        </ngx-datatable>
                    </div>
                </div>
            </nav>
        </div>
    </div>
</div>
