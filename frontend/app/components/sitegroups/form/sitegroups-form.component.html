<div class="main">
  <gn-cmr-header [path]="path" [currentPage]="(bEdit ? 'Edition ' : 'Création ')+ module.forms.sitegroup.label + (bEdit ? ': ' + sitegroup.name : '')"></gn-cmr-header>
  <div class="flex-container">
    <div class="cadre" [style.min-height]="cardContentHeight + 'px'">
      <pnx-map height="100%" class="map-card">
        <pnx-leaflet-draw 
          [geojson]="mapFeature ? mapFeature.geometry : null" 
          [options]="leafletDrawOptions" 
          [zoomLevel]="14"
          (layerDrawed)="setNewGeometry($event)">
        </pnx-leaflet-draw>
      </pnx-map>
    </div>
    <div class="cadre scroll">
      <div class="clearfix">
        <h4 class="float-left">{{ bEdit ? 'Edition' : 'Création'}} {{module.forms.sitegroup.label}} {{bEdit ? ': ' + sitegroup.name : ''}}</h4>
        <span class="float-right" *ngIf="!bEdit">
          <i class="fa fa-repeat fa-lg"></i>
          <mat-slide-toggle id="repeat" color="primary" [(ngModel)]="bChainInput" matTooltip="Enchainer les saisies"></mat-slide-toggle>
        </span>
      </div>
      <form [formGroup]="sitegroupForm">
        <div class="alert alert-danger" role="alert" *ngIf="!sitegroupForm.value.geom">
          <i class="fa fa-warning"></i>&nbsp;Veuillez saisir une géométrie sur la carte
        </div>
        <pnx-dynamic-form-generator
          class="obj-form"
          #dynamicForm
          [autoGenerated]="true"
          [myFormGroup]="sitegroupForm"
          [formsDefinition]="sitegroupFormDefinitions"
        ></pnx-dynamic-form-generator>
        <gn-cmr-form-error [form]="sitegroupForm"></gn-cmr-form-error>
        <div class="clearfix toolbar mt-3">
          <button class="btn btn-primary float-left" [routerLink]="['..']" *ngIf="!bEdit">Annuler</button>
          <button class="btn btn-primary float-left" [routerLink]="['..' , 'sitegroup', sitegroup.id_sitegroup]" *ngIf="bEdit">Annuler</button>
          <button *ngIf="!bChainInput  && !bEdit" class="btn btn-success float-right" [disabled]="!sitegroupForm.valid || bSaving" (click)="onSubmit(true)">
            <i *ngIf="!bSaving" class="fa fa-check"></i>
            <i *ngIf="bSaving" class="fa fa-spinner fa-spin"></i>&nbsp;Valider et ajouter {{module.forms.site.label}}</button>
          <button *ngIf="!bChainInput" class="btn btn-success float-right mr-2" [disabled]="!sitegroupForm.valid || bSaving" (click)="onSubmit(false)">
            <i *ngIf="!bSaving" class="fa fa-check"></i>
            <i *ngIf="bSaving" class="fa fa-spinner fa-spin"></i>&nbsp;Valider</button>
          <button *ngIf="bChainInput" class="btn btn-success float-right" [disabled]="!sitegroupForm.valid || bSaving" (click)="onSubmit(false)">
            <i *ngIf="!bSaving" class="fa fa-check"></i>
            <i *ngIf="bSaving" class="fa fa-spinner fa-spin"></i>&nbsp;Valider et enchainer les saisies</button>
        </div>
      </form>
    </div> 
  </div>
</div>
